---
title: "리액트 비동기 처리 전략"
datePublished: Mon Apr 07 2025 11:41:47 GMT+0000 (Coordinated Universal Time)
cuid: cm97045be000009joa52w83jr
slug: 66as7jwh7yq4iou5houpmeq4scdsspjrpqwg7kce6561

---

CSR 환경에서 비동기 요청의 성공과 실패, 로딩 케이스를 분리하여 유지보수성과 가독성 높은 구조를 만들고, 동시에 사용자에게 최적의 UX를 제공하기 위한 구조 설계

---

### **1️⃣** 비동기 (API 호출)처리 방식은 크게 3가지

## 1\. useQuery

React Query의 useQuery를 사용하여 각 API 요청을 개별적으로 관리할 수 있다.

* 병렬 호출: 조건부, 순차적인 API 호출로 네트워크에서 비용 소모가 크다.
    
* 에러/로딩 세분화: 가능, 각 API 요청에 대해 개별적인 로딩/에러 처리가 가능하다. 각 컴포넌트에서 useQuery를 사용하고 Suspense와 ErrorBoundary로 래핑한다
    
* 호출 시점: 렌더링 후 호출
    

## 2\. useQueries

React Query의 useQueries를 사용하여 여러 쿼리를 한 번에 관리하는 방식이다.

* 병렬 호출: API 호출을 병렬로처리하여 여러 API 호출을 한 곳에서 관리할 수 있다. (내장 병렬 처리)
    
* 에러/로딩 세분화: 어려움, Suspense fallback은 컴포넌트 레벨로 설정할 수 없고, 상위 컴포넌트에서 한 번만 설정 가능→ **로딩/에러 처리를 세분화하거나 확장하기가 어려움**
    
* 호출 시점: 렌더링 후 호출
    

## 3\. React Router의 loader + defer + Await

React Router v6.4+ 에서는 loader와 defer를 사용하여 API 데이터를 가져올 수 있다( (v7에서는 defer 대신 직접 Promise 반환)

* 특징: 라우팅과 데이터 페칭을 연결하여 코드를 정리할 수 있습니다.
    
* 병렬 호출: 가능 (Promise.all 병렬 처리)
    
* 에러/로딩 세분화: 가능, Suspense + Await 컴포넌트로 각 데이터별 로딩 상태 제어 가능, ErrorElement로 에러 제어
    
* 호출 시점: 렌더링 전 호출 시작 (`loader`는 **라우팅되는 순간** 호출)
    
* 단점: `loader + defer + Await` 조합은 "페이지(라우트) 컴포넌트"에서만 쓸 수 있다. → 하위 컴포넌트에서는 에러나 로딩처리하려면 useQuery로 별도로 처리해야됨
    

### **2️⃣** 전체 구조 흐름

페이지 단위의 필수 데이터는 loader로 prefetch하고, 하위 컴포넌트에서는 useQuery를 사용하는 구조로 설계

```javascript
[라우터 level]      →     [페이지 컴포넌트]      →       [하위 컴포넌트들]
loader              →     Suspense + Await     →        props

                                                        (깊은 위치) useQuery / useQueries (필요 시)
```

### **3️⃣** 주요 특징

1. **성능 최적화**
    
    * 페이지 진입 시 필수 데이터를 loader로 미리 가져와 초기 렌더링 성능 향상
        
    * React Query의 캐싱으로 중복 요청 방지
        
2. **코드 구조화**
    
    * 라우터 레벨: 페이지 단위 데이터 관리
        
    * 컴포넌트 레벨: 독립적인 데이터 페칭
        
    * **공용 상태**는 Zustand로 전역 관리 (예: 유저 정보, 언어 등)
        
3. **에러 처리**
    
    * 에러 모드 구분 : toast 메시지 / fallback UI
        
    * fallback UI 페이지 레벨 에러 처리(ErrorElement)
        
    * fallback UI 컴포넌트 레벨 에러 처리(ErrorBoundary)
        
4. **로딩처리**
    
    * 페이지 레벨: `loader`의 `Await`와 `Suspense`를 통해 주요 데이터별 로딩 상태 제어
        
    * 컴포넌트 레벨: `useQuery` `Suspense` 를 통해 로딩 상태 제어